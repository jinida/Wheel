@using System.ComponentModel.DataAnnotations

@if (IsVisible)
{
    <div class="modal-overlay" @onclick="Cancel">
        <div class="modal-content" @onclick:stopPropagation="true">

            <div class="modal-header">
                <h3>Create New Dataset</h3>
                <button class="close-button" @onclick="Cancel">&times;</button>
            </div>

            <div class="modal-body">
                <EditForm Model="@_model" OnValidSubmit="HandleValidSubmit">
                    <DataAnnotationsValidator />

                    <div class="form-group">
                        <label for="datasetName">Dataset Name</label>
                        <InputText id="datasetName"
                                   class="form-control"
                                   style="@GetInputStyle()"
                                   @bind-Value="_model.DatasetName"
                                   @oninput="OnNameInput"
                                   placeholder="Enter dataset name" />
                        <ValidationMessage For="@(() => _model.DatasetName)" />
                        @if (!string.IsNullOrEmpty(_validationError))
                        {
                            <div class="validation-message">@_validationError</div>
                        }
                    </div>

                    <div class="form-group">
                        <label for="description">Description</label>
                        <InputTextArea id="description" class="form-control" @bind-Value="_model.Description" placeholder="Optional details" />
                    </div>

                    <div class="form-group">
                        <label>Upload Images</label>

                        <div class="file-list-container">
                            @if (_uploadedFiles.Any())
                            {
                                <ul class="file-list">
                                    @foreach (var file in _uploadedFiles)
                                    {
                                        <li class="file-item">
                                            <span class="file-name" title="@file.Name">@file.Name</span>
                                            <span class="file-size">(@FormatBytes(file.Size))</span>
                                            <button type="button" class="remove-file-button" @onclick="() => RemoveFile(file)">&times;</button>
                                        </li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <div class="empty-file-list">
                                    <span>Empty</span>
                                </div>
                            }
                        </div>
                        <div class="upload-buttons">
                            <SnowButton type="button"
                                        ButtonVariant="@SnowButton.Variant.Outlined"
                                        ButtonSize="@SnowButton.Size.Medium"
                                        OnClick="TriggerFolderUpload">Upload Folder</SnowButton>

                            <SnowButton type="button"
                                        ButtonVariant="@SnowButton.Variant.Outlined"
                                        ButtonSize="@SnowButton.Size.Medium"
                                        OnClick="TriggerFileUpload">Upload Files</SnowButton>
                        </div>
                        <InputFile id="dataset-folder-upload-input" OnChange="LoadFiles" webkitdirectory accept=".png,.jpg,.jpeg,.bmp" style="display: none;" />
                        <InputFile id="dataset-file-upload-input" OnChange="LoadFiles" multiple accept=".png,.jpg,.jpeg,.bmp" style="display: none;" />
                    </div>

                    <div class="modal-footer">
                        <SnowButton ButtonVariant="@SnowButton.Variant.Light" ButtonSize="@SnowButton.Size.Medium" OnClick="Cancel">Cancel</SnowButton>
                        <SnowButton type="submit" ButtonVariant="@SnowButton.Variant.Filled" ButtonSize="@SnowButton.Size.Medium" TrailingIconUrl="svgs/arrow-right.svg">Next</SnowButton>
                    </div>
                </EditForm>
            </div>
        </div>
    </div>
}
